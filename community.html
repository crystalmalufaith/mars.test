  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mars.ai - Community</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link rel="stylesheet" href="style.css">
  </head>
  <body>

  <div class="header">
    <button id="sidebar-toggle" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">â˜°</button>
    <h1>Mars.ai</h1>
    <div></div>
  </div>

  <div class="sidebar">
    <nav class="nav">
      <a href="index.html">AI Tutor</a>
      <a href="decks.html">Decks</a>
      <a href="docs.html">Docs</a>
      <a href="quiz.html">Quiz</a>
      <a href="stats.html">Stats</a>
      <a href="community.html">Community</a>
      <a href="about.html">About</a>
      <a href="terms.html">Terms</a>
      <a href="#" id="account-link">Account</a>
    </nav>
  </div>

  <div class="main-section">
    <div class="main-container">
      <div class="page-header">
        <h1>Community</h1>
        <p>Explore shared documents and flashcard decks from other users</p>
      </div>

      <div class="community-section">
        <h2>Shared Documents</h2>
        <div class="documents-list" id="shared-documents-container">
          <!-- Shared documents will be displayed here -->
        </div>
      </div>

      <div class="community-section">
        <h2>Shared Flashcard Decks</h2>
        <div class="decks-grid" id="shared-decks-container">
          <!-- Shared decks will be displayed here -->
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="view-doc-modal">
    <div class="modal-content">
      <h2 id="view-doc-title">Document Title</h2>
      <div id="view-doc-content" style="max-height: 70vh; overflow-y: auto;"></div>
      <div class="modal-actions">
        <button onclick="closeViewDocModal()">Close</button>
      </div>
    </div>
  </div>

  <div class="modal" id="view-deck-modal">
    <div class="modal-content">
      <h2 id="view-deck-name">Deck Name</h2>
      <div id="view-deck-cards" style="max-height: 70vh; overflow-y: auto;">
        <!-- Cards will be listed here -->
      </div>
      <div class="modal-actions">
        <button onclick="closeViewDeckModal()">Close</button>
      </div>
    </div>
  </div>

  <div class="modal" id="account-modal">
    <div class="modal-content">
      <h2>Account</h2>
      <div id="account-info">
        <!-- Account info will be loaded here -->
      </div>
    </div>
  </div>

  <script>
  const user = JSON.parse(localStorage.getItem('currentUser'));
  if (!user) {
    window.location.href = 'sign-in.html?redirect=' + encodeURIComponent(window.location.href);
  }

  let sharedDocuments = JSON.parse(localStorage.getItem('sharedDocuments')) || [
    {
      id: 'sample-doc-1',
      title: 'Introduction to Machine Learning',
      content: '<h1>Introduction to Machine Learning</h1><p>Machine learning is a subset of artificial intelligence that enables computers to learn without being explicitly programmed.</p><h2>Key Concepts</h2><ul><li>Supervised Learning</li><li>Unsupervised Learning</li><li>Reinforcement Learning</li></ul>',
      sharedBy: 'Mars AI',
      date: '2025-01-01T00:00:00.000Z'
    },
    {
      id: 'sample-doc-2',
      title: 'Basic Calculus',
      content: '<h1>Basic Calculus</h1><p>Calculus is the mathematical study of continuous change.</p><h2>Fundamental Theorem</h2><p>$$\\int_a^b f(x) dx = F(b) - F(a)$$</p>',
      sharedBy: 'Math Tutor',
      date: '2025-01-02T00:00:00.000Z'
    }
  ];
  let sharedDecks = JSON.parse(localStorage.getItem('sharedDecks')) || [
    {
      id: 'sample-deck-1',
      name: 'Programming Basics',
      cards: [
        { front: 'What is a variable?', back: 'A storage location with a name.' },
        { front: 'What is a function?', back: 'A block of code that performs a task.' }
      ],
      sharedBy: 'Code Master',
      date: '2025-01-03T00:00:00.000Z'
    },
    {
      id: 'sample-deck-2',
      name: 'World Capitals',
      cards: [
        { front: 'Capital of France?', back: 'Paris' },
        { front: 'Capital of Japan?', back: 'Tokyo' }
      ],
      sharedBy: 'Geography Guru',
      date: '2025-01-04T00:00:00.000Z'
    }
  ];

  function renderSharedDocuments() {
    const container = document.getElementById('shared-documents-container');
    container.innerHTML = '';

    if (sharedDocuments.length === 0) {
      container.innerHTML = '<p style="text-align: center; color: #666;">No shared documents yet. Be the first to share!</p>';
      return;
    }

    sharedDocuments.forEach((doc, index) => {
      const docCard = document.createElement('div');
      docCard.className = 'doc-card';
      docCard.innerHTML = `
        <h3>${doc.title}</h3>
        <p>Shared by: ${doc.sharedBy}</p>
        <p>Shared on: ${new Date(doc.date).toLocaleDateString()}</p>
        <div class="doc-actions">
          <button onclick="viewSharedDocument(${index})">View</button>
          <button class="delete" onclick="deleteSharedDocument(${index})">Delete</button>
        </div>
      `;
      container.appendChild(docCard);
    });
  }

  function renderSharedDecks() {
    const container = document.getElementById('shared-decks-container');
    container.innerHTML = '';

    if (sharedDecks.length === 0) {
      container.innerHTML = '<p style="text-align: center; color: #666;">No shared decks yet. Be the first to share!</p>';
      return;
    }

    sharedDecks.forEach((deck, index) => {
      const deckCard = document.createElement('div');
      deckCard.className = 'deck-card';
      deckCard.innerHTML = `
        <h3>${deck.name}</h3>
        <p>${deck.cards ? deck.cards.length : 0} cards</p>
        <p>Shared by: ${deck.sharedBy}</p>
        <p>Shared on: ${new Date(deck.date).toLocaleDateString()}</p>
        <div class="deck-actions">
          <button onclick="viewSharedDeck(${index})">View</button>
          <button class="delete" onclick="deleteSharedDeck(${index})">Delete</button>
        </div>
      `;
      container.appendChild(deckCard);
    });
  }

  function viewSharedDocument(index) {
    const doc = sharedDocuments[index];
    document.getElementById('view-doc-title').textContent = doc.title;
    document.getElementById('view-doc-content').innerHTML = doc.content;

    // Render math
    renderMathInElement(document.getElementById('view-doc-content'), {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: false}
      ]
    });

    document.getElementById('view-doc-modal').classList.add('show');
  }

  function closeViewDocModal() {
    document.getElementById('view-doc-modal').classList.remove('show');
  }

  function viewSharedDeck(index) {
    const deck = sharedDecks[index];
    document.getElementById('view-deck-name').textContent = deck.name;
    const cardsContainer = document.getElementById('view-deck-cards');
    cardsContainer.innerHTML = '';

    if (!deck.cards || deck.cards.length === 0) {
      cardsContainer.innerHTML = '<p>No cards in this deck.</p>';
    } else {
      deck.cards.forEach(card => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'flashcard';
        cardDiv.innerHTML = `
          <strong>Front:</strong> ${card.front}<br>
          <strong>Back:</strong> ${card.back}
        `;
        cardsContainer.appendChild(cardDiv);
      });
    }

    document.getElementById('view-deck-modal').classList.add('show');
  }

  function closeViewDeckModal() {
    document.getElementById('view-deck-modal').classList.remove('show');
  }

  function deleteSharedDocument(index) {
    if (confirm('Are you sure you want to delete this shared document?')) {
      sharedDocuments.splice(index, 1);
      localStorage.setItem('sharedDocuments', JSON.stringify(sharedDocuments));
      renderSharedDocuments();
    }
  }

  function deleteSharedDeck(index) {
    if (confirm('Are you sure you want to delete this shared deck?')) {
      sharedDecks.splice(index, 1);
      localStorage.setItem('sharedDecks', JSON.stringify(sharedDecks));
      renderSharedDecks();
    }
  }

  // Account modal functions
  let outsideClickHandler;

  function openAccountModal() {
    const modal = document.getElementById('account-modal');
    const info = document.getElementById('account-info');
    const user = JSON.parse(localStorage.getItem('currentUser'));
    if (user) {
      info.innerHTML = `<p>Signed in as: ${user.name}</p><button class="auth-btn" onclick="logout()">Logout</button><br><button onclick="closeAccountModal()" style="background: none; border: none; color: #6c757d; cursor: pointer; margin: 1rem auto 0; display: block; text-align: center;">Close</button>`;
    } else {
      info.innerHTML = `<p>Not signed in</p><button class="auth-btn" onclick="window.location.href='sign-in.html'">Sign In</button><br><button onclick="closeAccountModal()" style="background: none; border: none; color: #6c757d; cursor: pointer; margin: 1rem auto 0; display: block; text-align: center;">Close</button>`;
    }
    modal.classList.add('show');
    outsideClickHandler = function(e) {
      if (e.target.id === 'account-modal') {
        closeAccountModal();
      }
    };
    document.addEventListener('click', outsideClickHandler);
  }

  function closeAccountModal() {
    document.getElementById('account-modal').classList.remove('show');
    if (outsideClickHandler) {
      document.removeEventListener('click', outsideClickHandler);
      outsideClickHandler = null;
    }
  }

  function logout() {
    localStorage.removeItem('currentUser');
    closeAccountModal();
    window.location.href = 'sign-in.html';
  }

  // Event listener for account link
  document.getElementById('account-link').addEventListener('click', function(e) {
    e.preventDefault();
    openAccountModal();
  });

  // Sidebar toggle
  document.getElementById('sidebar-toggle').addEventListener('click', () => {
    document.body.classList.toggle('sidebar-open');
    localStorage.setItem('sidebarOpen', document.body.classList.contains('sidebar-open'));
  });

  // Initialize sidebar state
  if (localStorage.getItem('sidebarOpen') === 'true') {
    document.body.classList.add('sidebar-open');
  }
  document.body.classList.add('sidebar-initialized');

  // Close sidebar when clicking outside
  document.addEventListener('click', (e) => {
    const sidebar = document.querySelector('.sidebar');
    const toggle = document.getElementById('sidebar-toggle');
    const accountModal = document.getElementById('account-modal');
    if (!sidebar.contains(e.target) && !toggle.contains(e.target) && document.body.classList.contains('sidebar-open') && !accountModal.classList.contains('show')) {
      document.body.classList.remove('sidebar-open');
      localStorage.setItem('sidebarOpen', false);
    }
  });

  // Initial render
  renderSharedDocuments();
  renderSharedDecks();
  </script>

  <script>
    const toggle = document.getElementById('sidebar-toggle');
    toggle.addEventListener('click', () => {
      document.body.classList.toggle('sidebar-closed');
    });
  </script>

  </body>
  </html>